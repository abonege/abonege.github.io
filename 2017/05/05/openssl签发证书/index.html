<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>openssl签发证书 | 秋月春风等闲度,暮去朝来颜色故</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">openssl签发证书</h1><a id="logo" href="/.">秋月春风等闲度,暮去朝来颜色故</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">openssl签发证书</h1><div class="post-meta">May 5, 2017</div><div class="post-content"><h1 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1.介绍"></a>1.介绍</h1><p>为了搭建https的测试环境，还是别用自己的正式证书了，想自己当把CA，颁发一些证书，自己当根。网上看了一些文章，都是当前目录建立一个demoCA这样的东西，但使用openssl ca 命令的时候，总是各种访问默认目录/etc/pki什么的，所以hi是放弃幻想了。直接用系统的目录做事情吧。</p>
<p>先看一下这个目录的结构吧</p>
<pre>
    [root@cq01-bce-48-29-31.cq01.baidu.com httpsec]# tree /etc/pki/CA
        /etc/pki/CA
        |-- certs
        |-- crl
        |-- newcerts
        `-- private
    4 directories, 0 files
</pre>


<h1 id="2-步骤"><a href="#2-步骤" class="headerlink" title="2.步骤"></a>2.步骤</h1><h2 id="2-1-生成私钥"><a href="#2-1-生成私钥" class="headerlink" title="2.1.生成私钥"></a>2.1.生成私钥</h2><p>进入CA目录，生成我们的一个私钥：</p>
<pre>
    cd /etc/pki/CA
    openssl genrsa -out private/cakey.pem 2048
</pre>

<p>大家可能问，公钥跑哪里去了，实际上生成的私钥里既有私钥，也有一些基础信息，用于将来生成公钥</p>
<pre>
    RSAPrivateKey ::= SEQUENCE {
        version Version,
        modulus INTEGER, -- n
        publicExponent INTEGER, -- e
        privateExponent INTEGER, -- d
        prime1 INTEGER, -- p
        prime2 INTEGER, -- q
        exponent1 INTEGER, -- d mod (p-1)
        exponent2 INTEGER, -- d mod (q-1)
        coefficient INTEGER, -- (inverse of q) mod p
        otherPrimeInfos OtherPrimeInfos OPTIONAL
    }

    RSAPublicKey ::= SEQUENCE {
        modulus INTEGER, -- n
        publicExponent INTEGER -- e
    }
</pre>


<h2 id="2-2-生成根证书"><a href="#2-2-生成根证书" class="headerlink" title="2.2.生成根证书"></a>2.2.生成根证书</h2><p>生成根证书有两种方式，一种是直接生成字签名根证书，一种是先生成根证书的请求文件csr，然后自己跟自己颁根证书</p>
<p>方法一</p>
<pre>
    openssl req -new -days 3650 -x509 -key ./private/cakey.pem -out  cacert.pem
</pre>


<p>方法二</p>
<pre>
    openssl req -new -key ./private/cakey.pem -out  rootca.csr
    openssl req -x509 -days 3650 -key ./private/cakey.pem -in rootca.csr -out cacert.pem
</pre>

<p>我们可以看下证书的内容</p>
<pre>
     openssl x509 -in rootca.crt -noout -text
</pre>



<h2 id="2-4-给别人签发证书"><a href="#2-4-给别人签发证书" class="headerlink" title="2.4.给别人签发证书"></a>2.4.给别人签发证书</h2><p>自己当了CA后，就可以给别人签发证书了。客户自己生成一个证书请求，给CA，CA就可以生成证书了</p>
<p>在客户机执行如下操作</p>
<pre>
    1.生成私钥
    openssl genrsa -out client1_key.pem 2048
    openssl  req -new -key  client1_key.pem  -out client1.csr
</pre>

<p>最后就是关键的 一步，签发证书,表示CA对证书申请者的认同。</p>
<pre>
    openssl ca -in client1.csr -out client1.pem
</pre>

<p>中间可能会提示index.txt文件和serial文件，按他的要求有这个两个文件即可，也可以一开始的时候就初始化好</p>
<pre>
    touch /etc/pki/CA/index.txt
    echo xyz > /etc/pki/CA/serial
</pre>

<p>好了，搞定！</p>
<p>期间需要注意的是，root CA的证书申请时候的Country,State,Comm那几个字段要一致，否则签发不了证书。可以自己试试。</p>
<p>补一个，证书导出公钥</p>
<pre>
openssl x509 -inform PEM -in client1.pem -outform PEM -pubkey -noout
</pre></div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2017/05/10/nginx的配置管理/">nginx的配置管理</a><a class="next" href="/2017/05/04/socket编程的内核实现/">socket编程的内核实现</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://abonege.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/生活/">生活</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/CC防护，nginx，封禁/" style="font-size: 15px;">CC防护，nginx，封禁</a> <a href="/tags/neutron/" style="font-size: 15px;">neutron</a> <a href="/tags/flow-table/" style="font-size: 15px;">flow-table</a> <a href="/tags/RSA加密/" style="font-size: 15px;">RSA加密</a> <a href="/tags/openssl/" style="font-size: 15px;">openssl</a> <a href="/tags/SSL/" style="font-size: 15px;">SSL</a> <a href="/tags/emacs/" style="font-size: 15px;">emacs</a> <a href="/tags/hyperscan/" style="font-size: 15px;">hyperscan</a> <a href="/tags/intel/" style="font-size: 15px;">intel</a> <a href="/tags/RegEx/" style="font-size: 15px;">RegEx</a> <a href="/tags/安全组/" style="font-size: 15px;">安全组</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/upstream/" style="font-size: 15px;">upstream</a> <a href="/tags/resolve/" style="font-size: 15px;">resolve</a> <a href="/tags/hyperscan编译/" style="font-size: 15px;">hyperscan编译</a> <a href="/tags/ovs/" style="font-size: 15px;">ovs</a> <a href="/tags/openvswitch/" style="font-size: 15px;">openvswitch</a> <a href="/tags/字节序/" style="font-size: 15px;">字节序</a> <a href="/tags/网络字节序，主机字节序/" style="font-size: 15px;">网络字节序，主机字节序</a> <a href="/tags/游记/" style="font-size: 15px;">游记</a> <a href="/tags/hexo使用/" style="font-size: 15px;">hexo使用</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/04/26/理解字节序/">理解字节序</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/14/a-out的幕后/">a.out的幕后</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/31/RSA算法证明/">RSA算法证明</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/05/SSL基础知识总结/">SSL基础知识总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/15/nginx实现动态resolve的思路/">nginx实现动态resolve的思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/07/nginx上支持手工封禁请求的的思路/">nginx上支持手工封禁请求的的思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/06/hyperscan使用/">hyperscan使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/23/关于编译hyperscan/">关于编译hyperscan</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/10/nginx的配置管理/">nginx的配置管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/05/openssl签发证书/">openssl签发证书</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">秋月春风等闲度,暮去朝来颜色故.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>